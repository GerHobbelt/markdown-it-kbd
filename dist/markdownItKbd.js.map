{"version":3,"file":"markdownItKbd.js","sources":["../src/index.ts"],"sourcesContent":["// [[kbd]]\n//\n\n// @ts-ignore markdown-it has no types and it’s not worth the effort adding a *.d.ts file\nimport MarkdownIt from 'markdown-it'\n// @ts-ignore markdown-it has no types and it’s not worth the effort adding a *.d.ts file\nimport StateInline from 'markdown-it/lib/rules_inline/state_inline'\n\nlet options = {\n\tMARKER_OPEN: '[[',\n\tMARKER_CLOSE: ']]',\n\tESCAPE_CHARACTER: '\\\\',\n\tTAG: 'kbd',\n\n\t// intern use; derived at time of initialization:\n\tMARKER_OPEN_1ST_CHR: 0\n}\n\n/*\n * Add delimiters for double occurrences of MARKER_SYMBOL.\n */\nfunction tokenize(state: StateInline, silent: boolean) {\n\tif (silent) {\n\t\treturn false\n\t}\n\n\tlet start = state.pos\n\tconst max = state.posMax\n\tconst momChar = state.src.charCodeAt(start)\n\n\t// TODO: check for escaped open & close markers (vanilla v2.2.0 only checks for escapes in the END marker, BTW...\n\n\t// We are looking for two times the open symbol.\n\tif (momChar !== options.MARKER_OPEN_1ST_CHR) {\n\t\treturn false\n\t}\n\tlet src = state.src.slice(start)\n\tif (!src.startsWith(options.MARKER_OPEN)) {\n\t\treturn false\n\t}\n\tconst startLen = options.MARKER_OPEN.length\n\tstart += startLen\n\tsrc = src.slice(startLen)\n\n\t// find the end sequence\n\tlet end = src.indexOf(options.MARKER_CLOSE)\n\tif (end < 0) {\n\t\t// no end marker found,\n\t\t// input ended before closing sequence\n\t\treturn false\n\t}\n\tconst lf = src.indexOf('\\n')\n\tif (lf >= 0 && lf < end) {\n\t\t// found end of line before the end sequence. Thus, ignore our start sequence!\n\t\treturn false\n\t}\n\tconst second = src.indexOf(options.MARKER_OPEN)\n\tif (second >= 0 && second < end) {\n\t\t// found another opening sequence before the end. Thus, ignore ours!\n\t\treturn false\n\t}\n\n\t// make end position into absolute index\n\tend += start\n\n\t// start tag\n\tstate.push('kbd_open', options.TAG, 1)\n\t// parse inner\n\tstate.pos = start\n\tstate.posMax = end\n\tstate.md.inline.tokenize(state)\n\tstate.pos = end + options.MARKER_CLOSE.length\n\tstate.posMax = max\n\t// end tag\n\tstate.push('kbd_close', options.TAG, -1)\n\n\treturn true\n}\n\nexport default function kbdplugin(markdownit: MarkdownIt, opts): void {\n\toptions = Object.assign(options, opts)\n\toptions.MARKER_OPEN_1ST_CHR = options.MARKER_OPEN.charCodeAt(0)\n\n\tmarkdownit.inline.ruler.before('link', 'kbd', tokenize)\n}\n"],"names":["options","MARKER_OPEN","MARKER_CLOSE","ESCAPE_CHARACTER","TAG","MARKER_OPEN_1ST_CHR","tokenize","state","silent","start","pos","max","posMax","momChar","src","charCodeAt","slice","startsWith","startLen","length","end","indexOf","lf","second","push","md","inline","kbdplugin","markdownit","opts","Object","assign","ruler","before"],"mappings":";;AAAA;AACA;AAOA,IAAIA,OAAO,GAAG;AACbC,EAAAA,WAAW,EAAE,IADA;AAEbC,EAAAA,YAAY,EAAE,IAFD;AAGbC,EAAAA,gBAAgB,EAAE,IAHL;AAIbC,EAAAA,GAAG,EAAE,KAJQ;AAMb;AACAC,EAAAA,mBAAmB,EAAE;AAPR,CAAd;AAUA;;;;AAGA,SAASC,QAAT,CAAkBC,KAAlB,EAAsCC,MAAtC;AACC,MAAIA,MAAJ,EAAY;AACX,WAAO,KAAP;AACA;;AAED,MAAIC,KAAK,GAAGF,KAAK,CAACG,GAAlB;AACA,QAAMC,GAAG,GAAGJ,KAAK,CAACK,MAAlB;AACA,QAAMC,OAAO,GAAGN,KAAK,CAACO,GAAN,CAAUC,UAAV,CAAqBN,KAArB,CAAhB;AAIA;;AACA,MAAII,OAAO,KAAKb,OAAO,CAACK,mBAAxB,EAA6C;AAC5C,WAAO,KAAP;AACA;;AACD,MAAIS,GAAG,GAAGP,KAAK,CAACO,GAAN,CAAUE,KAAV,CAAgBP,KAAhB,CAAV;;AACA,MAAI,CAACK,GAAG,CAACG,UAAJ,CAAejB,OAAO,CAACC,WAAvB,CAAL,EAA0C;AACzC,WAAO,KAAP;AACA;;AACD,QAAMiB,QAAQ,GAAGlB,OAAO,CAACC,WAAR,CAAoBkB,MAArC;AACAV,EAAAA,KAAK,IAAIS,QAAT;AACAJ,EAAAA,GAAG,GAAGA,GAAG,CAACE,KAAJ,CAAUE,QAAV,CAAN;;AAGA,MAAIE,GAAG,GAAGN,GAAG,CAACO,OAAJ,CAAYrB,OAAO,CAACE,YAApB,CAAV;;AACA,MAAIkB,GAAG,GAAG,CAAV,EAAa;AACZ;AACA;AACA,WAAO,KAAP;AACA;;AACD,QAAME,EAAE,GAAGR,GAAG,CAACO,OAAJ,CAAY,IAAZ,CAAX;;AACA,MAAIC,EAAE,IAAI,CAAN,IAAWA,EAAE,GAAGF,GAApB,EAAyB;AACxB;AACA,WAAO,KAAP;AACA;;AACD,QAAMG,MAAM,GAAGT,GAAG,CAACO,OAAJ,CAAYrB,OAAO,CAACC,WAApB,CAAf;;AACA,MAAIsB,MAAM,IAAI,CAAV,IAAeA,MAAM,GAAGH,GAA5B,EAAiC;AAChC;AACA,WAAO,KAAP;AACA;;;AAGDA,EAAAA,GAAG,IAAIX,KAAP;;AAGAF,EAAAA,KAAK,CAACiB,IAAN,CAAW,UAAX,EAAuBxB,OAAO,CAACI,GAA/B,EAAoC,CAApC;;AAEAG,EAAAA,KAAK,CAACG,GAAN,GAAYD,KAAZ;AACAF,EAAAA,KAAK,CAACK,MAAN,GAAeQ,GAAf;AACAb,EAAAA,KAAK,CAACkB,EAAN,CAASC,MAAT,CAAgBpB,QAAhB,CAAyBC,KAAzB;AACAA,EAAAA,KAAK,CAACG,GAAN,GAAYU,GAAG,GAAGpB,OAAO,CAACE,YAAR,CAAqBiB,MAAvC;AACAZ,EAAAA,KAAK,CAACK,MAAN,GAAeD,GAAf;;AAEAJ,EAAAA,KAAK,CAACiB,IAAN,CAAW,WAAX,EAAwBxB,OAAO,CAACI,GAAhC,EAAqC,CAAC,CAAtC;AAEA,SAAO,IAAP;AACA;;SAEuBuB,UAAUC,YAAwBC;AACzD7B,EAAAA,OAAO,GAAG8B,MAAM,CAACC,MAAP,CAAc/B,OAAd,EAAuB6B,IAAvB,CAAV;AACA7B,EAAAA,OAAO,CAACK,mBAAR,GAA8BL,OAAO,CAACC,WAAR,CAAoBc,UAApB,CAA+B,CAA/B,CAA9B;AAEAa,EAAAA,UAAU,CAACF,MAAX,CAAkBM,KAAlB,CAAwBC,MAAxB,CAA+B,MAA/B,EAAuC,KAAvC,EAA8C3B,QAA9C;AACA;;;;"}